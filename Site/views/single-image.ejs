<!--
  This file was automatically generated by gejs.  Please do not
  edit it directly.

  The command used to generate this file was
    gejs single-image.gejs -t mist.ejs -o single-image.ejs
 -->
<!DOCTYPE html>
<html lang="en">
 <head>
  <title> <%- image.title + " by " + image.username + " on MIST" %>
</title>
  <!-- Meta Information -->
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
   <% var jpgURL= "\"http://glimmer.grinnell.edu/jpg/"+image.imageid+"/?width=800&height=800\"" %>
   <meta property="og:image" content=<%- jpgURL %>/>

  <link rel="shortcut icon" href="/logos/favicon.ico">

  <!-- CSS -->
  <link rel='stylesheet' href='/css/styles.css'>
   <link rel="stylesheet" href="/css/single-image.css">
  


  <!-- Scripts -->
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript" src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
  <script type="text/javascript" src="/js/main.js"></script>
  <script type="text/javascript" src="/js/mist.js"></script>
  <script type="text/javascript" src="/js/mistui.js"></script>
  <script type="text/javascript" src="/js/likes.js"></script>
  <script type="text/javascript" src="/js/analytics.js"></script>
  <script type="text/javascript" src="/js/sharing-tools.js"></script>

   <script type="text/javascript" src="/js/single-image.js"></script>
   <script>
   function deleteImage() {
   if (! confirm("Are you sure you what to delete this image forever?")) {
     return;
   }
   var form = document.getElementById('delete-image');
   form.submit();
   } // deleteImage
   function setProfileImage() {
   if (! confirm("Are you sure that you want to change your profile image?")) {
     return;
   }
   var form = document.getElementById('profile-image');
   console.log("Setting profile image");
   form.submit();
   } // setProfileImage
   </script>
  

 </head>

 <body>
  <header>
    <div id="headerLogo">
      <a href="/"><img src="/logos/header.png"></a>
    </div>
    <form id="search" action="/search">
      <input type="search" name="searchQuery" id="searchBar">
      <input type="image" src="/icons/search.png" value="submit" width="20px" height="20px">
      <ul id="searchResults" class="menu"></ul>
    </form>
    <nav>
      <ul>
        <span class="main">
          <li><a href="/create">create</a></li>
          <li><a href="/challenges">challenges</a></li>
          <li><a href="/gallery">gallery</a></li>
          <li><a href="/about">about</a></li>
          <li><a href="/help">help</a></li>
          <% if (!user) { %>
            <li id="slider">login/signup</li>
        </span>
          <form method="POST" action="/login" class="hidden" style="display: none; opacity: 0;"><input type="text" placeholder="username" name="username" required="required"><input type="password" placeholder="password" name="password" require="required">
            <li id="rememberMeContainer"><label id="rememberMe">Remember Me<input type="checkbox" name="stayLoggedIn"></label></li>
            <li id="login">login</li>
            <li><a href="/signup">signup</a></li>
            <li id="cancel">cancel</li>
          </form>
          <% } else {%>
            <li><a href='/me'><%= user.username %></a></li>
            <li><a href='/logout'>logout</a></li>
        </span>
          <% } %>
      </ul>
    </nav>
  </header>
  <div id="main">
<div id="pageTitleGeneral"><h1>     <%- image.title %>
</h1></div>
<div id="subTitle"><h2>     <%- image.modifiedAt.toUTCString() %>
    
</h2></div>
     <figure>
     <canvas id="canvas" width="400" height="400"></canvas>
     <div id="image-sharing" data-imageid=<%= image.imageid %>>
       <figcaption class="<%= liked ? 'left starred' : 'left unstarred' %>">â˜…<%- image.rating %></figcaption>
       <div id="image-fb-share" data-href="<%= 'http://glimmer.grinnell.edu/image/' + image.imageid %>" data-type="button" class="fb-share-button"></div>
       <a id="image-tweet" href="https://twitter.com/share" data-lang="en" data-text= '<%- "Check out " + ((user&&user.userid===image.userid) ? "my image, \"" + image.title + "\"" : "\"" + image.title + "\" by " + image.username) + " on @MISTbyGlimmer"%>' data-url=<%- "\"http://glimmer.grinnell.edu/image/" + image.imageid + "\"" %> class="twitter-share-button">
         <Tweet>      </Tweet>
       </a>
     <a href="<%='/user/' + image.username %>">
       <figcaption class="right"><%- image.username %></figcaption>
     </a>
     </div> <!-- image-sharing -->
     <div id="image-controls">
       <% if(image.code.indexOf("t.") > -1 || image.code.indexOf("m.") > -1) { %>
       <button id="animator" class="animations">stop</button>
     <% } %>
       <button id="jpeg" class="animations">jpeg</button>
       <button id="showcode" class="animations">code</button>
        Resolution: 1px <input id="pixels" type="range" min="1" max="400" value="200" step ="1"> 400px
     </div> <!-- image-controls -->
     </figure>
     <p id="code" class="code" style="display:none;"><%- image.code %></p>
     <div style="align:center; margin-left: auto; margin-right: auto; width:100%;">
     <p id="pretty" class="pretty" style="display:none;"></p>
     </div>
     <table id="comments">
     <% for (var i = 0; i < comments.length; i++) { %>
       <tr class="comment" id=<%- "'comment" + comments[i].commentId + "'" %>>
         <th class="user">
           <a href='<%= "/user/" + comments[i].username %>'><%- comments[i].username %></a>
         </th>
         <td class="comment"><%- comments[i].comment %></td>
         <td class="date"><script>document.write(describeDate("<%= comments[i].postedAt %>"))</script></td>
         <% if(user) { %>
           <td class='flagComment <%= (comments[i].flagged) ? 'flaggedComment' : ''%>'>&#9873</td>
           <% if(user.type == "A" || user.type == "M" || user.userid == comments[i].userid || user.userid == image.userid) { %>
             <td class='deleteComment'>X</td>
           <% } %>
         <% } %>
       </tr>
     <% } // for %>
     <% if (user) { %>
       <div id="menu">
         <ul>
           <% if (image.userid === user.userid) { %>
             <!-- Option: make profile image -->
             <li>
               <form id='profile-image' method='POST'>
                 <input type='hidden' value= <%= image.imageid %> name='profile' />
                 <a class="menuitem" href='javascript:void(0);' onclick="setProfileImage()">set profile image</a>
               </form>
             </li>
             <!-- Option: Delete image -->
             <li>
               <form id='delete-image' method='POST'>
                 <input type='hidden' value= <%= image.imageid %> name='delete' />
                 <a class="menuitem" href='javascript:void(0);' onclick="deleteImage()">
                   delete image
                 </a>
               </form>
             </li>
           <% } // if it's the user's image %>
           <!-- Option: Feature Image -->
           <% if(user.type == "A" || user.type == "M") { %>
             <% if(image.featured == 1) { %>
               <li id="featureImage" data-featureStatus="false" data-imageid='<%=image.imageid%>'>unfeature image</li>
             <% } else { %>
               <li id="featureImage" data-featureStatus="true" data-imageid='<%=image.imageid%>'>feature image</li>
             <% } %>
           <% } // If user is moderator or admin %>
           <!-- Option: Add to album -->
           <% if (albums.length > 0) { %>
             <li>add to album
               <script>
               function addToAlbum(albumid) {
                 var imageid = <%- image.imageid %>;
                 console.log("adding",imageid,"to album",albumid);
                 api("addToAlbum", {imageid:imageid, albumid:albumid}, function(success,error) {
                   if (error) {
                     alert(error);
                     return false;
                   }
                   return true;
                 });
               } // addToAlbum(albumid)
               </script>
               <ul>
                 <% for (var i=0; i < albums.length; i++) { %>
                   <li>
                     <a href=<%- '/user/' + user.username + '/albums/' + albums[i].albumid %>
                        onClick='addToAlbum(<%- albums[i].albumid %>)'>
                         <%= albums[i].name %>
                       </a>
                   </li>
                 <% } // for %>
               </ul>
             </li>
           <% } // if (albums.length > 0) %>
         </ul>
       </div> <!-- menu -->
    
       <tr id="leaveComment" class="comment">
         <th class="user">
           <a href=<%="/user/" + user.username %>><%-user.username%></a>
         </th>
         <td class="comment"><form method="POST"><textarea name="newComment" required="required" placeholder="leave a comment"></textarea><input type="submit" value="submit" name="commentSubmit"></form></td>
       </tr>
     <% } %>
     </table>

  </div>
  <footer>
   <p>&copy;2014 Glimmer Labs</p>
   <div id="sharing">
    <div id="fb-root"><div data-href="https://facebook.com/MISTbyGlimmer" data-width="450" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false" class="fb-like"></div></div>
    <a id="twitter-follow" href="https://twitter.com/MISTbyGlimmer" data-show-count="true" data-lang="en" class="twitter-follow-button"><Follow>@MISTbyGlimmer</Follow></a>
    <div id="google-follow"><div data-annotation="bubble" data-height="20" data-href="//plus.google.com/u/0/117519228748872063766" data-rel="author" class="g-follow"></div></div></div>
   <nav>
    <ul>
     <li><a href="/create">create</a></li>
     <li><a href="/challenges">challenges</a></li>
     <li><a href="/gallery">gallery</a></li>
     <li><a href="/about">about</a></li>
     <% if(user) {%>
     <li><a href="/me">my account</a></li>
<% } else { %>
     <li><a href="/login">login</a></li>
     <li><a href="/signup">signup</a></li>
     <% } %>
     <li><a href="/license">license</a></li>
     <li><a href="/privacypolicy">privacy policy</a></li>
    </ul>
   </nav>
  </footer>
 </body>
</html>
